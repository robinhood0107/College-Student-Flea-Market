<!DOCTYPE html>
<html class="light" lang="ko">
<head>
  <%- include('../partials/head') %>
  <title>상품 목록 | Campus flea Market</title>
</head>
<body class="font-display bg-main text-main">
  <div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">
    <div class="layout-container flex h-full grow flex-col">
      <%- include('../partials/header') %>
      
      <!-- 메인 콘텐츠 -->
      <main class="main-content">
        <div class="layout-content-container">
          <!-- 페이지 제목 -->
          <div class="page-header">
            <div class="page-header-content">
              <h1 class="page-title">Find Your Next Treasure</h1>
              <p class="page-subtitle">Browse thousands of items from students on your campus.</p>
            </div>
          </div>
          <!-- 카테고리 필터 -->
          <div class="category-filter">

            <% const categories = [
              { en: "Electronics", ko: "디지털기기" },
              { en: "Books", ko: "도서" },
              { en: "Furniture", ko: "가구/인테리어" },
              { en: "Dorm Essentials", ko: "생활가전" },
              { en: "Clothing", ko: "의류" }
            ]; %>

            <!-- ALL 버튼 -->
            <a href="/product/list"
              class="category-button <%= !category ? 'category-button-active' : 'category-button-inactive' %>">
              <p>All</p>
            </a>

            <!-- 카테고리들 -->
            <% categories.forEach(cat => { %>
              <a href="/product/list?category=<%= encodeURIComponent(cat.en) %>"
                class="category-button <%= category === cat.ko ? 'category-button-active' : 'category-button-inactive' %>">
                <p><%= cat.en %></p>
              </a>
            <% }); %>

          </div>
          <!-- 정렬 버튼 -->
          <div class="sort-section">
            <div class="sort-wrapper">
              <button class="sort-btn" id="sort-btn">
                <span class="material-symbols-outlined text-lg">sort</span>

                <!-- 정렬 텍스트 표시 -->
                <p class="text-main text-sm font-medium leading-normal" id="sort-label">
                  <%= sort === 'price_low' ? 'Price Low'
                      : sort === 'price_high' ? 'Price High'
                      : 'Latest' %>
                </p>

                <span class="material-symbols-outlined text-lg">expand_more</span>
              </button>

              <div class="sort-dropdown hidden" id="sort-dropdown">
                <button class="sort-option" data-sort="latest">최신순</button>
                <button class="sort-option" data-sort="price_low">가격 낮은순</button>
                <button class="sort-option" data-sort="price_high">가격 높은순</button>
              </div>
            </div>
          </div>
          <!-- 상품 그리드 -->
          <div class="product-grid">
            <% if (typeof products !== 'undefined' && products.length > 0) { %>
              <% products.forEach(product => { %>
              <div class="product-card" data-product-id="<%= product.id %>">
                <a href="/product/<%= product.id %>" class="product-card-link">
                  <div class="product-image-wrapper">
                    <!-- 상품 이미지 -->
                    <div class="product-image" style='background-image: url("<%= product.thumbnail || '/uploads/default.jpg' %>");'></div>
                    <!-- 상품 상태 뱃지 -->
                    <span class="product-status-badge 
                          <%= product.status === 'FOR_SALE' 
                                ? 'status-sale' 
                                : product.status === 'RESERVED' 
                                ? 'status-reserved' 
                                : 'status-sold' %>">
                      <%= product.status === 'FOR_SALE'
                          ? '판매중'
                          : product.status === 'RESERVED'
                          ? '예약중'
                          : '판매완료' %>
                    </span>
                  </div>
                  <div>
                    <div class="flex items-center gap-2">
                      <!-- 상품명 -->
                      <p class="product-title"><%= product.title %></p>
                    </div>
                    <!-- 가격 -->
                    <p class="product-price">₩<%= product.price.toLocaleString() %></p>
                    <div class="product-meta">
                      <!-- 거래 장소 -->
                      <span><%= product.location || '장소 미지정' %></span>
                      <!-- 찜 개수 -->
                      <div class="flex items-center gap-1">
                        <span class="material-symbols-outlined !text-base text-red-500" style="font-variation-settings: 'FILL' 1;">favorite</span>
                        <span class="like-count"><%= product.like_count || 0 %></span>
                      </div>
                    </div>
                  </div>
                </a>
                <!-- 찜하기 버튼 (로그인한 사용자 그리고 본인 제품이 아닌 제품에만 보이기) -->
                <% if (user && product.seller_id !== user.id) { %>
                <button class="like-button" data-like-product="<%= product.id %>" type="button" aria-label="찜하기">
                  <span class="material-symbols-outlined"
                        style="font-variation-settings: 'FILL' <%= product.is_liked ? 1 : 0 %>;">
                      <%= product.is_liked ? 'favorite' : 'favorite_border' %>
                  </span>
                </button>
                <% } %>
              </div>
              <% }); %>
            <% } else { %>
              <div class="empty-state">
                <p class="empty-state-text">등록된 상품이 없습니다.</p>
              </div>
            <% } %>
          </div>
        </div>
      </main>
    </div>
      <%- include('../partials/footer') %>

      <!-- 상품 관련 JS -->
      <script src="/js/product.js"></script>
    </div>
  </div>
</body>
</html>

