<!DOCTYPE html>
<html class="light" lang="ko">
<head>
  <%- include('../partials/head') %>
  <title>상품 목록 | Campus flea Market</title>
</head>
<body class="font-display bg-main text-main">
  <div class="relative flex min-h-screen w-full flex-col group/design-root overflow-x-hidden">
    <div class="layout-container flex h-full grow flex-col">
      <%- include('../partials/header') %>
      
      <!-- 메인 콘텐츠 -->
      <main class="main-content">
        <div class="layout-content-container">
          <!-- 페이지 제목 -->
          <div class="page-header">
            <div class="page-header-content">
              <h1 class="page-title">Find Your Next Treasure</h1>
              <p class="page-subtitle">Browse thousands of items from students on your campus.</p>
            </div>
          </div>
          <!-- 카테고리 필터 -->
          <div class="category-filter">
            <a href="/product/list" class="category-button category-button-active">
              <p>All</p>
            </a>
            <% const categories = ['Electronics', 'Books', 'Furniture', 'Dorm Essentials', 'Clothing']; %>
            <% categories.forEach(category => { %>
            <a href="/product/list?category=<%= encodeURIComponent(category) %>" class="category-button category-button-inactive">
              <p><%= category %></p>
            </a>
            <% }); %>
          </div>
          <!-- 정렬 버튼 -->
          <div class="sort-section">
            <div class="relative">
              <button class="sort-btn">
                <span class="material-symbols-outlined text-lg">sort</span>
                <p class="text-main text-sm font-medium leading-normal">Latest</p>
                <span class="material-symbols-outlined text-lg">expand_more</span>
              </button>
            </div>
          </div>
          <!-- 상품 그리드 -->
          <div class="product-grid">
            <% if (typeof products !== 'undefined' && products.length > 0) { %>
              <% products.forEach(product => { %>
              <div class="product-card" data-product-id="<%= product.id %>">
                <a href="/product/<%= product.id %>" class="product-card-link">
                  <div class="product-image-wrapper">
                    <!-- 상품 이미지 -->
                    <div class="product-image" style='background-image: url("<%= product.main_image || '/uploads/default.jpg' %>");'></div>
                    <!-- 상품 상태 뱃지 -->
                    <span class="product-status-badge"><%= product.condition || 'Good' %></span>
                  </div>
                  <div>
                    <div class="flex items-center gap-2">
                      <!-- 상품명 -->
                      <p class="product-title"><%= product.title %></p>
                      <% if (product.is_verified) { %>
                      <!-- 학교인증 뱃지 -->
                      <span class="verified-badge">
                        <span class="material-symbols-outlined !text-sm" style="font-variation-settings: 'FILL' 1;">school</span>
                        <span>학교인증</span>
                      </span>
                      <% } %>
                    </div>
                    <!-- 가격 -->
                    <p class="product-price">₩<%= product.price.toLocaleString() %></p>
                    <div class="product-meta">
                      <!-- 거래 장소 -->
                      <span><%= product.location || '장소 미지정' %></span>
                      <!-- 찜 개수 -->
                      <div class="flex items-center gap-1">
                        <span class="material-symbols-outlined !text-base text-red-500" style="font-variation-settings: 'FILL' 1;">favorite</span>
                        <span class="like-count"><%= product.like_count || 0 %></span>
                      </div>
                    </div>
                  </div>
                </a>
                <!-- 찜하기 버튼 (로그인한 사용자만 표시) -->
                <% if (typeof user !== 'undefined' && user) { %>
                <button class="like-button" data-like-product="<%= product.id %>" type="button" aria-label="찜하기">
                  <span class="material-symbols-outlined">favorite_border</span>
                </button>
                <% } %>
              </div>
              <% }); %>
            <% } else { %>
              <div class="empty-state">
                <p class="empty-state-text">등록된 상품이 없습니다.</p>
              </div>
            <% } %>
          </div>
        </div>
      </main>
    </div>
      <%- include('../partials/footer') %>
    </div>
  </div>
</body>
</html>

